<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Online</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #e5ddd5; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #header { background: #075e54; color: white; padding: 15px; text-align: center; font-weight: bold; }
        #chat-box { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 8px 12px; border-radius: 10px; max-width: 75%; word-wrap: break-word; font-size: 15px; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
        .msg.me { background: #dcf8c6; align-self: flex-end; }
        .msg.them { background: white; align-self: flex-start; }
        .msg b { display: block; font-size: 11px; color: #666; margin-bottom: 2px; }
        footer { padding: 10px; background: #f0f0f0; display: flex; gap: 8px; }
        input { flex: 1; padding: 12px; border: none; border-radius: 20px; outline: none; }
        button { background: #075e54; color: white; border: none; padding: 0 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <div id="header">PHÒNG CHAT CHUNG</div>
    <div id="chat-box"></div>
    <footer>
        <input type="text" id="msgInput" placeholder="Nhập tin nhắn..." autocomplete="off">
        <button onclick="send()">GỬI</button>
    </footer>

    <script>
        const firebaseConfig = { databaseURL: "https://chat-f916d-default-rtdb.asia-southeast1.firebasedatabase.app/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref("messages");

        let myName = localStorage.getItem('chat-user') || prompt("Nhập tên của bạn:", "Khách " + Math.floor(Math.random() * 100));
        localStorage.setItem('chat-user', myName);

        function send() {
            const input = document.getElementById('msgInput');
            if (input.value.trim() !== "") {
                db.push({ name: myName, message: input.value, time: Date.now() });
                input.value = "";
            }
        }

        db.limitToLast(50).on("child_added", (snapshot) => {
            const data = snapshot.val();
            const div = document.createElement('div');
            div.className = `msg ${data.name === myName ? 'me' : 'them'}`;
            div.innerHTML = `<b>${data.name}</b>${data.message}`;
            document.getElementById('chat-box').appendChild(div);
            document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
        });

        document.getElementById('msgInput').onkeypress = (e) => { if (e.key === "Enter") send(); };
    </script>
</body>
</html>
